//! å®šä¹‰ã€Œè¯æ³•Narseseã€çš„æ ¼å¼
//! * ğŸ“ŒWHYï¼šåŸå…ˆã€Œæšä¸¾Narseseã€ä¸­çš„ã€ŒNarseseæ ¼å¼ã€æå‰å®šä¹‰äº†æ‰€æœ‰ã€ŒNarseseè¯é¡¹ç±»å‹ã€çš„èŒƒå›´
//!   * ğŸ¯å¸Œæœ›èƒ½æ‰©å®½ã€ŒåŸå­è¯é¡¹ã€ã€Œå¤åˆè¯é¡¹ã€ã€Œé™ˆè¿°ã€çš„ç±»å‹
//! * ğŸ¯æä¾›CommonNarseseä¸­æ‰€æœ‰çš„è¯æ³•ä¿¡æ¯
//!   * âš ï¸ä»…ä½œä¸ºã€Œä¿¡æ¯ã€ä½¿ç”¨ï¼Œä¸æä¾›ä»»ä½• è§£ææ—¶/æ ¼å¼åŒ–æ—¶ ä¼˜åŒ–
//! * ğŸš©ç›®å‰å¯¹æ­¤å¤„çš„ã€Œæ ¼å¼ã€ä¸è¿›è¡Œé‡å‘½åå¤„ç†
//!   * ğŸ“Œç†ç”±ï¼šå¯ä»¥ç”¨ã€Œè·¯å¾„é™å®šã€ã€Œuse * asã€ç»•å¼€ã€Œé‡åé—®é¢˜ã€
//! * ğŸš©æ­¤å¤„ä¸å†å¼€æ”¾ã€Œå†…å®¹`Content`ã€ç±»å‹
//!   * ğŸ“Œã€Œè¯æ³•Narseseã€æ•°æ®ç»“æ„ä¸­å·²å›ºå®šç±»å‹ä¸º[`String`]/&[`str`]
//!   * å› æ­¤æ•´ä¸ªã€Œè¯æ³•Narseseæ ¼å¼ã€å·²ç»å’Œå­—ç¬¦ä¸²ç»‘å®šäº†
//!
//! ! ã€2024-03-18 20:33:31ã€‘å½“ä¸‹ç»Ÿä¸€ä½¿ç”¨ã€ŒåŠ¨æ€å­—ä¸²ã€[`String`]
//!   * âŒå¼ƒç”¨`&str`çš„ç†ç”±
//!     * ç”Ÿå‘½å‘¨æœŸç®¡ç†å†—æ‚ | ğŸ’­å…è®¸ç‰ºç‰²ä¸€å®šæ€§èƒ½ï¼Œä¸“æ³¨åŠŸèƒ½
//!     * å‰ç¼€åŒ¹é…å­—å…¸ä¸å…¼å®¹ | æ— æ³•åˆå¹¶ã€ŒåŠ¨æ€å­—ä¸²å‰ç¼€åŒ¹é…ã€ä¸ã€Œé™æ€å­—ä¸²å‰ç¼€åŒ¹é…ã€

use nar_dev_utils::{
    BiFixMatchDict, BiFixMatchDictPair, PrefixMatchDict, SuffixMatchDict, SuffixMatchDictPair,
};

/// Narseseæ ¼å¼/ç©ºç™½ç¬¦
#[derive(Debug, Clone)]
pub struct NarseseFormatSpace {
    /// ç”¨äºåˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºç©ºç™½ç¬¦ï¼ˆè§£æç”¨ï¼‰
    /// * ğŸ“Rustä¸­è‹¥éœ€å®šä¹‰é™æ€å¸¸é‡ï¼Œéœ€è¦å¯¹å¸¸é‡ç¡®ä¿çº¿ç¨‹å®‰å…¨
    ///   * ğŸ“„çº¿ç¨‹å®‰å…¨çš„ç±»å‹â‡”å®ç°`Send + Sync`ç‰¹å¾
    ///   * âš ï¸`Box`ç±»å‹æ— æ³•ä½œä¸ºå¸¸é‡åˆå§‹åŒ–â‡’é€€è€Œæ±‚å…¶æ¬¡ï¼Œå˜ä¸ºã€Œé™æ€å˜é‡ã€â‡’ä¸å¯å˜`static`ä»ç„¶è¦æ±‚å¸¸é‡è¡¨è¾¾å¼
    ///   * âš ï¸ä»»ä½•é—­åŒ…ç±»å‹éƒ½ä¸é»˜è®¤å®ç°`Send + Sync`ï¼šç›´æ¥`static`æ— æ³•å®ç°çº¿ç¨‹å®‰å…¨
    ///   * ğŸš©æœ€ç»ˆæ–¹æ¡ˆ
    ///     * âœ…å¸¸é‡è¡¨è¾¾å¼ï¼šä½¿ç”¨[`lazy_statics`]å®ç°ã€Œé™æ€æ‡’åŠ è½½ã€ç»•å¼€ã€Œ`static`è¦æ±‚å¸¸é‡è¡¨è¾¾å¼ã€é™åˆ¶
    ///     * âœ…çº¿ç¨‹å®‰å…¨ï¼šé™åˆ¶ä¸‹è¾¹é—­åŒ…ä¸º`dyn Fn(char) -> bool + Send + Sync`
    ///       * ğŸ“Œå…¶é€šå¸¸å°±æ˜¯ä¸ªçº¯å‡½æ•°
    pub is_for_parse: fn(char) -> bool,

    /// è§£æå‰æ˜¯å¦ç­›é™¤ç©ºç™½ç¬¦
    /// ğŸ¯ç”¨äºå†³å®šåœ¨ã€Œè§£æç¯å¢ƒç†æƒ³åŒ–ã€æ—¶æ˜¯å¦è¦ã€Œé¢„ç­›é™¤ç©ºç™½ç¬¦ã€
    pub remove_spaces_before_parse: bool,

    /// ç©ºç™½ç¬¦ï¼ˆæ ¼å¼åŒ–/åˆ†éš”è¯é¡¹ï¼‰
    /// * ğŸ¯å¤åˆè¯é¡¹/é™ˆè¿°
    ///   * ğŸ“„å¤åˆè¯é¡¹ï¼š`(&&, A, B, C)`
    ///   * ğŸ“„é™ˆè¿°ï¼š`<A --> B>`
    pub format_terms: String,

    /// ç©ºç™½ç¬¦ï¼ˆæ ¼å¼åŒ–/åˆ†éš”æ¡ç›®ï¼‰
    /// * ğŸ¯ã€Œé¢„ç®— è¯é¡¹æ ‡ç‚¹ æ—¶é—´æˆ³ çœŸå€¼ã€
    pub format_items: String,
}

/// åŸå­è¯é¡¹æ ¼å¼
/// * ğŸ“Œæ ¼å¼ï¼š[å‰ç¼€] + (æ ‡è¯†ç¬¦)
#[derive(Debug, Clone)]
pub struct NarseseFormatAtom {
    /// åˆæ³•çš„ã€ŒåŸå­è¯é¡¹å‰ç¼€ã€
    /// * è¯è¯­
    /// * ç‹¬ç«‹å˜é‡
    /// * éç‹¬å˜é‡
    /// * æŸ¥è¯¢å˜é‡
    /// * é—´éš”
    /// * æ“ä½œç¬¦
    pub prefixes: PrefixMatchDict,

    /// ç”¨äºåˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºã€Œåˆæ³•åŸå­æ ‡è¯†ç¬¦ã€çš„å‡½æ•°
    pub is_identifier: fn(char) -> bool,
}

/// å¤åˆè¯é¡¹æ ¼å¼
#[derive(Debug, Clone)]
pub struct NarseseFormatCompound {
    /// åˆæ³•çš„ã€Œé›†åˆå¤åˆè¯é¡¹æ‹¬å¼§å¯¹ã€
    /// * å¤–å»¶é›†
    /// * å†…æ¶µé›†
    pub set_brackets: BiFixMatchDictPair,

    /// é€šç”¨çš„ã€Œå¤åˆè¯é¡¹æ‹¬å¼§å¯¹ã€
    pub brackets: (String, String),

    /// å¤åˆè¯é¡¹å…ƒç´ åˆ†éš”ç¬¦
    pub separator: String,

    /// åˆæ³•çš„ã€Œå¤åˆè¯é¡¹è¿æ¥ç¬¦ã€
    /// * å¤–å»¶äº¤/å†…æ¶µäº¤
    /// * å¤–å»¶å·®/å†…æ¶µå·®
    /// * ä¹˜ç§¯
    /// * å¤–å»¶åƒ/å†…æ¶µåƒ
    /// * åˆå–/æå–
    /// * å¦å®š
    /// * é¡ºåºåˆå–/å¹³è¡Œåˆå–
    pub connecters: PrefixMatchDict,
}

/// é™ˆè¿°æ ¼å¼
#[derive(Debug, Clone)]
pub struct NarseseFormatStatement {
    /// é€šç”¨çš„ã€Œé™ˆè¿°æ‹¬å¼§å¯¹ã€
    pub brackets: (String, String),

    /// åˆæ³•çš„ã€Œä¸­ç¼€ç³»è¯ã€
    /// * ç»§æ‰¿
    /// * ç›¸ä¼¼
    /// * è•´å«
    /// * ç­‰ä»·
    /// * å®ä¾‹/å±æ€§/å®ä¾‹å±æ€§
    /// * é¢„æµ‹æ€§/å¹¶å‘æ€§/å›é¡¾æ€§ è•´å«
    /// * é¢„æµ‹æ€§/å¹¶å‘æ€§/å›é¡¾æ€§ ç­‰ä»·
    pub copulas: BiFixMatchDict,
}

/// è¯­å¥æ ¼å¼ï¼ˆå«æ ‡ç‚¹ã€çœŸå€¼ã€æ—¶é—´æˆ³ï¼‰
#[derive(Debug, Clone)]
pub struct NarseseFormatSentence {
    /// åˆæ³•çš„ã€Œæ ‡ç‚¹ã€
    pub punctuations: SuffixMatchDict,

    /// çœŸå€¼æ‹¬å¼§
    /// * ğŸš©é€šè¿‡æ‹¬å¼§æ•è·æ•´ä¸ªã€ŒçœŸå€¼ã€å­—ç¬¦ä¸²ï¼Œç„¶åæ‹†åˆ†å…¶å†…éƒ¨ç»“æ„
    pub truth_brackets: (String, String),

    /// çœŸå€¼å†…éƒ¨åˆ†éš”ç¬¦
    /// * ğŸ¯ç”¨äºè¿›ä¸€æ­¥**ç»†åˆ†**å†…éƒ¨çš„å€¼
    ///   * ğŸ“Œã€2024-03-22 20:02:15ã€‘åˆæ¬¡éœ€æ±‚è§NAVMçš„ã€Œä¸åŒæ ¼å¼è¯æ³•Narseseäº’è½¬ã€çš„æƒ…å½¢
    /// * ğŸ“åŸåˆ™ï¼šä¸èƒ½åŒ…æ‹¬ä»»ä½•ã€Œå…·ä½“æ ¼å¼å›ºå®šã€çš„å†…å®¹
    ///   * ğŸ“„å¦‚ã€Œæ¼¢æ–‡ã€æ ¼å¼ä¸­å­˜å‚¨"$1.0; 0.9$"ä½œä¸ºã€Œåˆæ³•ã€æƒ…å†µ
    /// * ğŸš©ã€2024-03-22 20:04:09ã€‘ç›®å‰çš„å®ç°æ–¹æ³•ï¼šä½œä¸ºã€Œæ•°å€¼å­—ä¸²æ•°ç»„ã€çš„å½¢å¼
    ///   * ğŸ“„å½¢å¦‚`vec!["1.0", "0.9"]`ç›®å‰æ˜¯æœ€ä½³å®è·µ
    pub truth_separator: String,

    /// åˆ¤æ–­æ˜¯å¦ä¸ºã€ŒçœŸå€¼å†…éƒ¨å…è®¸çš„å­—ç¬¦ã€
    /// * ğŸ¯ç”¨äºæä¾›ä¿¡æ¯ä»¥æ›´å¿«åˆ†å‰²è¾¹ç•Œï¼ˆä»é¢„ç®—å€¼è€Œæ¥ï¼‰
    pub is_truth_content: fn(char) -> bool,

    /// åˆæ³•çš„æ—¶é—´æˆ³ã€Œæ‹¬å¼§ã€å¯¹
    /// * ğŸ¯é€‚é…LaTeX/æ¼¢æ–‡çš„ã€Œæ— å›ºå®šæ‹¬å¼§ã€æƒ…å†µ
    /// * ğŸ“å¯¹äºã€Œæ—¶é—´æˆ³ã€ä¸èƒ½å†å†åƒASCIIç‰ˆæœ¬é‚£æ ·å‡è®¾ã€Œä¸€å®šæœ‰å›ºå®šæ‹¬å¼§ã€äº†
    ///   * ğŸ“„ASCIIã®ã€Œè¿‡å»ã€ï¼š`:\:` => `("", ":\:")`
    ///   * ğŸ“„LaTeXã®ã€Œè¿‡å»ã€ï¼š`\backslash\!\!\!\!\!\Rightarrow` => `("", "\backslash\!\!\!\!\!\Rightarrow")`
    ///   * ğŸ“Œæ­¤å¤„å¯ç»Ÿä¸€ä½¿ç”¨ã€Œç©ºå‰ç¼€ã€å…¼å®¹ã€Œæšä¸¾æ—¶é—´æˆ³ã€ï¼šå®é™…ä½¿ç”¨æ—¶è¿›è¡Œåç¼€åŒ¹é…ï¼Œç©ºå‰ç¼€å¯å®ç°ä¸ã€Œç‰¹åˆ«å¼€ä¸€ä¸ª`enum_stamps`ã€åŸºæœ¬ä¸€æ ·çš„æ€§èƒ½
    /// * ğŸ¯ä¸€å¹¶å¤„ç†æœ‰å…³ã€Œå›ºå®šæ—¶é—´æˆ³ã€çš„é—®é¢˜ï¼šå†…éƒ¨åˆæ³•å­—ç¬¦åˆ¤å®š
    ///   * ğŸ“„ASCIIã®ã€Œå›ºå®šã€ï¼š`:!137:` => `(":!", ":")`
    ///   * ğŸ“„LaTeXã®ã€Œå›ºå®šã€ï¼š`t=[+-][0-9]+` => `("t=", "")`
    /// * ğŸš©åœ¨ã€Œæšä¸¾æ—¶é—´æˆ³ã€ä¹‹åï¼Œä»¥æ›´ç»†åˆ†çš„æ–¹å¼ã€æ­£ç¡®ã€‘æ•è·ã€Œå›ºå®šæ—¶é—´æˆ³ã€ç±»å‹
    ///   * å®é™…ä¸Šæ˜¯ä¸€ç§ã€Œæ‹¬å¼§åŒ¹é…ã€
    /// * âœ¨ç›´æ¥é€šè¿‡ã€Œä¸åŒç±»æ‹¬å¼§ã€å…¼å®¹å„ç±»ã€Œå›ºå®šæ—¶é—´æˆ³ã€ç±»å‹
    ///   * ğŸ“Œè€Œæ— éœ€å›ºå®šã€Œæ—¶é—´æˆ³æ‹¬å¼§ã€
    pub stamp_brackets: SuffixMatchDictPair<String>,

    /// åˆæ³•çš„ã€Œå›ºå®šæ—¶é—´æˆ³ã€
    /// * ğŸ¯é€‚é…LaTeX/æ¼¢æ–‡çš„ã€Œæ— å›ºå®šæ‹¬å¼§ã€æƒ…å†µ
    /// * ğŸ“Œé€šè¿‡ã€Œåˆæ³•å­—ç¬¦åºåˆ—ã€å…¼å®¹ã€Œå‰åç¼€ä¸å›ºå®šçš„ã€å›ºå®šã€æ—¶é—´æˆ³ç±»å‹ã€
    ///   * ğŸ“„ASCIIã®ã€Œå›ºå®šã€ï¼š`:!-123:`
    pub is_stamp_content: fn(char) -> bool,
}

/// ä»»åŠ¡æ ¼å¼ï¼ˆå«é¢„ç®—å€¼ï¼‰
#[derive(Debug, Clone)]
pub struct NarseseFormatTask {
    /// é¢„ç®—å€¼æ‹¬å¼§
    /// * ğŸš©é€šè¿‡æ‹¬å¼§æ•è·æ•´ä¸ªã€Œé¢„ç®—å€¼ã€å­—ç¬¦ä¸²ï¼Œç„¶åæ‹†åˆ†å…¶å†…éƒ¨ç»“æ„
    pub budget_brackets: (String, String),

    /// é¢„ç®—å€¼å†…éƒ¨åˆ†éš”ç¬¦
    /// * ğŸ¯ç”¨äºè¿›ä¸€æ­¥**ç»†åˆ†**å†…éƒ¨çš„å€¼
    /// * ğŸ“„æ¥ç”±ã€ç”¨æ³•ç­‰å‚è€ƒ[`NarseseFormatSentence::truth_separator`]
    pub budget_separator: String,

    /// åˆ¤æ–­æ˜¯å¦ä¸ºã€Œé¢„ç®—å€¼å†…éƒ¨å…è®¸çš„å­—ç¬¦ã€
    /// * ğŸ¯ç”¨äºè§£å†³å¯èƒ½çš„ã€Œé¢„ç®—å€¼ğŸ†šç‹¬ç«‹å˜é‡ã€ã€Œè¯¯æŠ¥çš„é¢„ç®—å€¼èŒƒå›´ã€çš„é—®é¢˜
    /// * ğŸ“Œåœ¨ã€Œæ€»è§£ææ–¹æ³•ã€ä¸­ï¼Œä»¥æ­¤ä¸ºå‡­æ®åˆ†å‰²ã€Œé¢„ç®—å€¼ã€
    ///   * â“ä¼¼ä¹å®é™…ä¸Šçš„caseå¹¶ä¸å­˜åœ¨ï¼šé¢„ç®—åªä¼šåœ¨å¼€å¤´è¿›è¡ŒåŒ¹é…
    /// * ğŸš©è‹¥å¼€å¤´åŒ¹é…äº†é¢„ç®—å€¼å·¦æ‹¬å¼§ï¼Œåˆ™
    ///   * å‰ç¼€åŒ¹é…å³æ‹¬å¼§ï¼ˆææ—©ç»“æŸï¼‰
    ///   * æ”¶å…¥å‰ã€é€šè¿‡æ­¤å‡½æ•°ã€‘**ç¡®è®¤**å°†æ”¶å…¥çš„å­—ç¬¦æ˜¯å¦åˆæ³•
    /// * ğŸ“„case@ASCII: `$$$independent.`â‡’ç©ºé¢„ç®—ã€è¯é¡¹ä¸º`$independent`ã€åˆ¤æ–­ã€æ°¸æ’ã€ç©ºçœŸå€¼
    ///   * âœ…è§£æè¿‡ç¨‹ï¼šé‡åˆ°ç¬¬äºŒä¸ª`$`è§†ä½œé—­æ‹¬å¼§ï¼Œææ—©ç»“æŸ
    /// * ğŸ“„case@ASCII: `$$independent.`â‡’ç©ºé¢„ç®—ã€è¯é¡¹ä¸º`independent`ã€åˆ¤æ–­ã€æ°¸æ’ã€ç©ºçœŸå€¼
    ///   * âœ…è§£æè¿‡ç¨‹ï¼šé‡åˆ°ç¬¬äºŒä¸ª`$`è§†ä½œé—­æ‹¬å¼§ï¼Œææ—©ç»“æŸ
    /// * ğŸ“„case@ASCII: `$independent.`â‡’ç©ºé¢„ç®—ã€è¯é¡¹ä¸º`$independent`ã€åˆ¤æ–­ã€æ°¸æ’ã€ç©ºçœŸå€¼
    ///   * âœ…è§£æè¿‡ç¨‹ï¼šé‡åˆ°éæ³•å†…å®¹`i`æå‰ç»“æŸ
    ///   * â—æ— æ­¤å‡½æ•°çš„ç‰ˆæœ¬ï¼šæ²¡é‡åˆ°é—­æ‹¬å¼§ï¼Œæå‰ç»“æŸ
    /// * ğŸ“„case@æ¼¢æ–‡: `é¢„ç®—ã€‚`â‡’è§£æé”™è¯¯ï¼šæ²¡æœ‰è¯é¡¹
    ///   * âœ…è§£æè¿‡ç¨‹ï¼šé‡åˆ°å³æ‹¬å¼§`ç®—`è§†ä½œé—­æ‹¬å¼§ï¼Œææ—©ç»“æŸ
    /// * ğŸ“„case@æ¼¢æ–‡: `é¢„ç®—é¢„ç®—ã€‚`â‡’ç©ºé¢„ç®—ã€è¯é¡¹ä¸º`é¢„ç®—`ã€åˆ¤æ–­ã€æ°¸æ’ã€ç©ºçœŸå€¼
    ///   * âœ…è§£æè¿‡ç¨‹ï¼šé‡åˆ°å³æ‹¬å¼§`ç®—`è§†ä½œé—­æ‹¬å¼§ï¼Œææ—©ç»“æŸ
    /// * ğŸ“„case@æ¼¢æ–‡: `é¢„é¢„ç®—ã€‚`â‡’ç©ºé¢„ç®—ã€è¯é¡¹ä¸º`é¢„é¢„ç®—`ã€åˆ¤æ–­ã€æ°¸æ’ã€ç©ºçœŸå€¼
    ///   * âœ…è§£æè¿‡ç¨‹ï¼šé‡åˆ°éæ³•å†…å®¹`é¢„`æå‰ç»“æŸ
    ///   * âš ï¸æ— æ­¤å‡½æ•°çš„ç‰ˆæœ¬ï¼šæˆªå–åˆ°`é¢„é¢„ç®—`ï¼Œåè¾¹æ²¡è¯é¡¹â‡’æŠ¥é”™
    pub is_budget_content: fn(char) -> bool,
}

/// æ€»ã€Œè¯æ³•Narseseæ ¼å¼ã€
/// * âš™ï¸åŒ…æ‹¬ï¼š
///   * åŸå­è¯é¡¹æ ¼å¼
///   * å¤åˆè¯é¡¹æ ¼å¼
///   * é™ˆè¿°æ ¼å¼
///   * è¯­å¥æ ¼å¼ï¼ˆå«æ ‡ç‚¹ã€çœŸå€¼ã€æ—¶é—´æˆ³ï¼‰
///   * ä»»åŠ¡æ ¼å¼ï¼ˆå«é¢„ç®—å€¼ï¼‰
/// * ğŸš©ä¸ç‰¹åŒ–ç¬¦å·ä¸º`LexicalNarseseFormat`
///   * ğŸ“Œè¿™ç§ã€Œç¬¦å·ç‰¹åŒ–ã€äº¤ç»™è°ƒç”¨æ–¹å¤„ç†
/// * ğŸš©ã€2024-06-13 19:13:59ã€‘ç°åœ¨ä½¿ç”¨å‡½æ•°æŒ‡é’ˆï¼Œè€Œé[`Box`]å †åˆ†é…æŒ‡é’ˆç±»å‹
///   * âœ…ä¸å†éœ€è¦å¼•å…¥æ³›å‹å‚æ•°
#[derive(Debug, Clone)]
pub struct NarseseFormat {
    /// ç©ºç™½ç¬¦æ ¼å¼
    pub space: NarseseFormatSpace,

    /// åŸå­è¯é¡¹æ ¼å¼
    pub atom: NarseseFormatAtom,

    /// å¤åˆè¯é¡¹æ ¼å¼
    pub compound: NarseseFormatCompound,

    /// é™ˆè¿°æ ¼å¼
    pub statement: NarseseFormatStatement,

    /// è¯­å¥æ ¼å¼ï¼ˆå«æ ‡ç‚¹ã€çœŸå€¼ã€æ—¶é—´æˆ³ï¼‰
    pub sentence: NarseseFormatSentence,

    /// ä»»åŠ¡æ ¼å¼ï¼ˆå«é¢„ç®—å€¼ï¼‰
    pub task: NarseseFormatTask,
    // ! ç›¸æ¯”ã€Œæšä¸¾Narseseã€ä¸å†æœ‰ã€Œå…³é”®è¯æˆªæ–­é€‰é¡¹ã€
    // ! ğŸš©ã€2024-03-15 17:48:03ã€‘ç›®å‰`enable_keyword_truncation`å¼ºåˆ¶ä¸º`true`
}
